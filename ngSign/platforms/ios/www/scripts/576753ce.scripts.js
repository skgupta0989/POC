"use strict";var ngSignItApp=angular.module("ngSignItApp",["MyDirectives","DataServices","ui"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/parse",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]);"use strict";var MainCtrl=ngSignItApp.controller("MainCtrl",function(a,b){a.clearData=function(){a.user={firstName:null,lastName:null,signature:null,email:null}},a.pickPetition=function(c){c?(a.petitionDescription=a.petitionCollection.get(c).get("description"),a.formDisabled=!1):(a.petitionDescription="Choose a cause / petition / whatever in the box above, then plop down your name, email address, and John Hancock below to show your support.",a.formDisabled=!0,a.clearData())},a.getSignatures=function(d){d.length>0?b.getSignatures(d,function(b){a.$apply(function(){a.signatureList=b})}):a.signatureList=[]},a.saveSignature=function(){a.sigForm.$valid&&(a.user.petitionId=a.select2,b.saveSignature(a.user,function(){a.clearData(),a.getSignatures(a.select2)}))},a.signatureList=[],a.clearData(),a.formDisabled=!0,b.getPetitions(function(b){a.$apply(function(){a.petitionCollection=b,a.petitions=b.models})})});MainCtrl.$inject=["$scope","DataService"],angular.module("MyDirectives",[]).directive("sigpad",function(a){return{templateUrl:"views/sigPad.html",restrict:"E",scope:!0,require:"ngModel",link:function(b,c,d,e){var f=$(c).signaturePad({drawOnly:!0,lineColour:"#FFF"});$(d.clearbtn).on("click",function(a){f.clearCanvas()}),$(c).find(".pad").on("touchend",function(a){b.updateModel()}),b.updateModel=function(){a(function(){e.$setViewValue(f.getSignature())})},e.$render=function(){e.$viewValue?f.regenerate(e.$viewValue):f.clearCanvas()},e.$parsers.unshift(function(a){return console.log("validating",a),f.validateForm()?(e.$setValidity("sigpad",!0),a):(e.$setValidity("sigpad",!1),undefined)})}}}).directive("regensigpad",function(){return{template:'<img ng-src="{{pic}}" />',restrict:"E",scope:{sigdata:"@"},link:function(a,b,c,d){c.$observe("sigdata",function(b){var c=$('<div class="sig sigWrapper"><canvas class="pad" width="436" height="120"></canvas></div>').signaturePad({displayOnly:!0});c.regenerate(b),a.pic=c.getSignatureImage()})}}}),angular.module("DataServices",[]).factory("ParseService",function(){Parse.initialize("d46qFYur20F0T5XqD61wGWHtey9z3Q1ouBkm2t3X","8Mo9iTOBJmmcPwAYcT4EppSBZlQulHn75RUT9Sny");var a=Parse.Object.extend("signature"),b=Parse.Collection.extend({model:a}),c=Parse.Object.extend("petition"),d=Parse.Collection.extend({model:c}),e={name:"Parse",getPetitions:function(b){var c=new d;c.fetch({success:function(a){b(c)},error:function(a,b){alert("Collection Error: "+b.message)}})},saveSignature:function(c,d){var e=new a;e.save(c,{success:function(a){d(a)},error:function(a,b){alert("Error: "+b.message)}})},getSignatures:function(c,d){var e=new Parse.Query(a);e.equalTo("petitionId",c),e.find({success:function(a){d(a)},error:function(a){alert("Error: "+a.message)}})}};return e}).factory("StackMobService",function(){StackMob.init({appName:"ngsignit",clientSubdomain:"bourbonbasement",publicKey:"ef6fd991-a12f-416d-9d36-a31e14f2590f",apiVersion:0});var a=StackMob.Model.extend({schemaName:"signature"}),b=StackMob.Collection.extend({model:a}),c=StackMob.Model.extend({schemaName:"petition"}),d=StackMob.Collection.extend({model:c}),e={name:"StackMob",getPetitions:function(b){var c=new d,e=new StackMob.Collection.Query;c.query(e,{success:function(a){b(c.add(a))},error:function(a,b){alert("Collection Error: "+b.message)}})},saveSignature:function(c,d){var e=new a;e.set({firstname:c.firstName,lastname:c.lastName,petitionid:c.petitionId,email:c.email,signature:JSON.stringify(c.signature)}),e.save({},{success:function(a){d(a)},error:function(a,b){alert("Error: "+b.message)}})},getSignatures:function(c,d){var e=new b,f=new StackMob.Collection.Query,g=[];f.equals("petitionid",c),e.query(f,{success:function(a){a.each(function(a){a.set({signature:JSON.parse(a.get("signature")),firstName:a.get("firstname"),lastName:a.get("lastname")}),g.push(a)}),d(g)},error:function(a,b){alert("Error: "+b.message)}})}};return e}).factory("BackboneService",function(a){var b=Backbone.Model.extend(),c=Backbone.Collection.extend({model:b}),d=Backbone.Model.extend(),e=Backbone.Collection.extend({model:d}),f=new d,g=new d,h=new c,i=new e;return f.set({id:"8n37f7s",title:"NASA Should Start Mining The Moon to Fund Itself",description:"NASA is way too expensive. It should take all of its rockets and shuttles, go to the moon, dig up expensive metals and minerals, and bring them back. They could then sell everything to raise money to send people to Mars. Like a bake sale. Only with moon rocks."}),g.set({id:"9ns764mg",title:"Create a protective habitat for refugee cows.",description:"Brave cows who escape from their captors live a life of fear and anxiety. They are always hiding, and always on the run.  A protective sanctuary is needed to protect the brave bovine that want a life of freedom and prosperity."}),i.add([f,g]),BackboneService={name:"Backbone",getPetitions:function(c){a(function(){c(i)})},saveSignature:function(d,e){var f=new b;f.set({firstName:d.firstName,lastName:d.lastName,email:d.email,signature:d.signature,petitionId:d.petitionId}),h.add(f),a(function(){e(f)})},getSignatures:function(c,d){var e=h.where({petitionId:c});a(function(){d(e)})}},BackboneService}).factory("DataService",function(a,b,c,d){var e=c;if(d.absUrl().indexOf("stackmob")>0||d.absUrl().indexOf("4567")>0)e=b;return d.path()==="/parse"&&(e=a),e});